<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>Netanya Surf Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e0f7fa;
      padding: 2em;
      text-align: center;
    }
    h1 {
      color: #00796b;
    }
    .chart-container {
      width: 90%;
      max-width: 800px;
      margin: 2em auto;
    }
    canvas {
      max-width: 100%;
    }
    .info-box {
      background: #ffffff;
      border-radius: 8px;
      padding: 1em;
      margin: 1em auto;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .info-box h3 {
      margin-bottom: 0.5em;
      color: #00796b;
    }
  </style>
</head>
<body>
  <h1>🌊 Netanya Surf Tracker</h1>

  <div class="info-box" id="conditionsBox">
    <h3>תנאים נוכחיים בפולג</h3>
    <p id="windInfo">רוח: טוען...</p>
    <p id="tideInfo">גובה גאות: טוען...</p>
  </div>

  <div class="chart-container">
    <canvas id="forecastChart"></canvas>
  </div>

  <script>
    async function fetchMarineData(lat, lon) {
      const url = `https://marine-api.open-meteo.com/v1/marine?latitude=${lat}&longitude=${lon}&daily=wave_height_max,tide_height_max,wind_speed_10m_max,wind_direction_10m_dominant&timezone=auto`;
      const response = await fetch(url);
      const data = await response.json();

      const labels = data.daily.time.map(date => date.slice(5)); // MM-DD
      const waveData = data.daily.wave_height_max;
      const windSpeed = data.daily.wind_speed_10m_max[0];
      const windDir = data.daily.wind_direction_10m_dominant[0];
      const tide = data.daily.tide_height_max ? data.daily.tide_height_max[0] : "לא זמין";

      return { labels, waveData, windSpeed, windDir, tide };
    }

    function getWindDirection(degrees) {
      const directions = ['צפון', 'צפון-מזרח', 'מזרח', 'דרום-מזרח', 'דרום', 'דרום-מערב', 'מערב', 'צפון-מערב'];
      return directions[Math.round(degrees / 45) % 8];
    }

    async function renderForecast() {
      const { labels, waveData, windSpeed, windDir, tide } = await fetchMarineData(32.270, 34.825); // Poleg

      document.getElementById("windInfo").textContent = `רוח: ${windSpeed} קמ"ש, כיוון ${getWindDirection(windDir)}`;
      document.getElementById("tideInfo").textContent = `גובה גאות: ${tide} מטר`;

      new Chart(document.getElementById('forecastChart'), {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'גובה גלים יומי בפולג (מטר)',
            data: waveData,
            borderColor: '#0288d1',
            backgroundColor: 'rgba(2,136,209,0.2)',
            fill: true
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    renderForecast();
  </script>
</body>
</html>
